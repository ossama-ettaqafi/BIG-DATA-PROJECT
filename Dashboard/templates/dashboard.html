<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fake News Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<h1>üì∞ Fake News Detection Dashboard</h1>

<div class="cards">
    <div class="card card-blue">
        <h2>Total Predictions</h2>
        <p>{{ total_predictions }}</p>
    </div>
    <div class="card card-green">
        <h2>Correct Predictions</h2>
        <p>{{ correct_predictions }}</p>
    </div>
    <div class="card card-orange">
        <h2>Global Accuracy</h2>
        <p>{{ global_accuracy }}%</p>
    </div>
    <div class="card card-purple">
        <h2>Real vs Fake</h2>
        <p>Real: {{ real_count }} | Fake: {{ fake_count }}</p>
    </div>
</div>

<h2>üìä Evaluation Metrics per Batch</h2>

<table>
    <thead>
        <tr>
            <th>Batch ID</th>
            <th>Timestamp</th>
            <th>Accuracy</th>
            <th>Precision</th>
            <th>Recall</th>
            <th>F1-Score</th>
        </tr>
    </thead>
    <tbody>
        {% for row in metrics %}
        <tr>
            <td>{{ row.batch_id }}</td>
            <td>{{ row.timestamp }}</td>
            <td>{{ row.accuracy }}</td>
            <td>{{ row.precision }}</td>
            <td>{{ row.recall }}</td>
            <td>{{ row.f1_score }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h2>üßÆ Real vs Fake Distribution</h2>

<div class="chart-container">
    <canvas id="distributionChart"></canvas>
</div>

<h2>üìù Try a News Prediction</h2>

<form method="POST">
    <textarea name="news_text" rows="4" cols="80" placeholder="Enter news here...">{{ user_text }}</textarea><br>
    <button type="submit">Predict</button>
</form>

{% if new_prediction %}
    <h3>Prediction: <span class="prediction">{{ new_prediction }}</span></h3>
{% endif %}

<script>
    const ctx = document.getElementById('distributionChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Real News', 'Fake News'],
            datasets: [{
                label: 'Distribution',
                data: [{{ real_count }}, {{ fake_count }}],
                backgroundColor: ['#2ecc71', '#e74c3c'],
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y', // ‚ûî barres horizontales
            responsive: true,
            scales: {
                x: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
</script>

</body>
</html>
